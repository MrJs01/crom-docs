<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Contagem de Palavras</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        .test-result {
            background-color: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #333;
        }
        .test-title {
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 10px;
        }
        .test-content {
            background-color: #333;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .word-count {
            font-weight: bold;
            color: #2196F3;
        }
    </style>
</head>
<body>
    <h1>Teste de Contagem de Palavras</h1>
    <p>Este teste verifica se a lógica de contagem de palavras está funcionando corretamente.</p>
    
    <div id="test-results"></div>
    
    <script>
        // Função de contagem de palavras (versão corrigida)
        function countWords(content) {
            if (!content || typeof content !== 'string' || content.trim() === '') {
                return 0;
            }
            
            let text = content
                .replace(/<[^>]*>/g, '') // Remove HTML
                .replace(/&[^;]+;/g, ' ') // Remove entidades HTML
                .replace(/[^\w\s\u00C0-\u017F\u0100-\u024F\u1E00-\u1EFF]/g, ' ') // Remove pontuação, mantém acentos
                .replace(/\s+/g, ' ') // Normaliza espaços
                .trim();
            
            if (text.length > 0) {
                const words = text.split(/\s+/).filter(word => word.length > 0);
                return words.length;
            }
            
            return 0;
        }
        
        // Testes
        const testCases = [
            {
                name: "Texto simples",
                content: "Esta é uma frase simples com várias palavras.",
                expected: 9
            },
            {
                name: "Texto com HTML",
                content: "<h1>Título</h1><p>Este é um <strong>parágrafo</strong> com <em>formatação</em>.</p>",
                expected: 9
            },
            {
                name: "Texto com entidades HTML",
                content: "Texto com &amp; entidades &lt;especiais&gt; e &quot;aspas&quot;.",
                expected: 7
            },
            {
                name: "Texto com acentos",
                content: "Palavras com acentos: café, coração, não, será.",
                expected: 8
            },
            {
                name: "Texto complexo",
                content: `<h1>Bem-vindo ao Seu Novo Documento!</h1>
                        <p class="lead">Comece a digitar para criar conteúdo incrível.</p>
                        <h2>Principais Recursos</h2>
                        <ul>
                            <li><strong>Edição de Texto Rico:</strong> Negrito, itálico, sublinhado.</li>
                            <li><strong>Espaço de Trabalho:</strong> Gerencie facilmente seus documentos.</li>
                        </ul>`,
                expected: 28
            },
            {
                name: "Texto vazio",
                content: "",
                expected: 0
            },
            {
                name: "Apenas HTML",
                content: "<div><br></div>",
                expected: 0
            }
        ];
        
        const resultsDiv = document.getElementById('test-results');
        
        testCases.forEach((test, index) => {
            const result = countWords(test.content);
            const isCorrect = result === test.expected;
            
            const testDiv = document.createElement('div');
            testDiv.className = 'test-result';
            testDiv.innerHTML = `
                <div class="test-title">
                    Teste ${index + 1}: ${test.name} 
                    <span style="color: ${isCorrect ? '#4CAF50' : '#f44336'}">
                        ${isCorrect ? '✓ PASSOU' : '✗ FALHOU'}
                    </span>
                </div>
                <div class="test-content">${test.content}</div>
                <div>
                    <span class="word-count">Resultado: ${result} palavras</span>
                    <span style="color: #888; margin-left: 20px;">Esperado: ${test.expected}</span>
                </div>
            `;
            
            resultsDiv.appendChild(testDiv);
        });
        
        // Simular dados de documentos
        const mockDocuments = [
            {
                id: 'doc1',
                name: 'Documento 1',
                category: 'Categoria A',
                content: 'Este é o primeiro documento com algumas palavras.'
            },
            {
                id: 'doc2',
                name: 'Documento 2',
                category: 'Categoria B',
                content: '<h1>Título</h1><p>Este é um documento com HTML e mais palavras.</p>'
            },
            {
                id: 'doc3',
                name: 'Documento 3',
                category: 'Categoria A',
                content: 'Outro documento na mesma categoria com texto diferente.'
            }
        ];
        
        // Teste de filtros
        const filterTests = [
            {
                name: "Todos os documentos",
                filter: 'Todos',
                expectedDocs: 3,
                expectedWords: countWords(mockDocuments[0].content) + countWords(mockDocuments[1].content) + countWords(mockDocuments[2].content)
            },
            {
                name: "Categoria A",
                filter: 'Categoria A',
                expectedDocs: 2,
                expectedWords: countWords(mockDocuments[0].content) + countWords(mockDocuments[2].content)
            },
            {
                name: "Categoria B",
                filter: 'Categoria B',
                expectedDocs: 1,
                expectedWords: countWords(mockDocuments[1].content)
            }
        ];
        
        const filterDiv = document.createElement('div');
        filterDiv.innerHTML = '<h2>Teste de Filtros por Categoria</h2>';
        resultsDiv.appendChild(filterDiv);
        
        filterTests.forEach((test, index) => {
            let filteredDocs = mockDocuments;
            if (test.filter !== 'Todos') {
                filteredDocs = mockDocuments.filter(doc => doc.category === test.filter);
            }
            
            const totalWords = filteredDocs.reduce((sum, doc) => sum + countWords(doc.content), 0);
            const docsCorrect = filteredDocs.length === test.expectedDocs;
            const wordsCorrect = totalWords === test.expectedWords;
            
            const testDiv = document.createElement('div');
            testDiv.className = 'test-result';
            testDiv.innerHTML = `
                <div class="test-title">
                    Filtro: ${test.name} 
                    <span style="color: ${docsCorrect && wordsCorrect ? '#4CAF50' : '#f44336'}">
                        ${docsCorrect && wordsCorrect ? '✓ PASSOU' : '✗ FALHOU'}
                    </span>
                </div>
                <div>
                    <span class="word-count">Documentos: ${filteredDocs.length} (esperado: ${test.expectedDocs})</span>
                    <span style="color: ${docsCorrect ? '#4CAF50' : '#f44336'}; margin-left: 20px;">
                        ${docsCorrect ? '✓' : '✗'}
                    </span>
                </div>
                <div>
                    <span class="word-count">Palavras: ${totalWords} (esperado: ${test.expectedWords})</span>
                    <span style="color: ${wordsCorrect ? '#4CAF50' : '#f44336'}; margin-left: 20px;">
                        ${wordsCorrect ? '✓' : '✗'}
                    </span>
                </div>
            `;
            
            resultsDiv.appendChild(testDiv);
        });
    </script>
</body>
</html>
